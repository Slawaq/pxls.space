function Notabot(a){a.ignore=a.ignore||[],a.dir=a.dir||0,a.pixelize=a.pixelize||!1,this.image=a}function launchBot(a){function h(){(App.cooldown-(new Date).getTime())/1e3>0?setTimeout(h,WAIT_DELAY):(c||setTimeout(i,FORCE_DELAY),setTimeout(h,DRAW_DELAY))}function i(){a.board.data=updateBoardData(a.board);for(var c=0,e=0;e<a.template.data.width;e++)for(var f=0;f<a.template.data.height;f++){var h=j(e,f);null!=h&&c++}switch(d=Math.ceil(100-c/b*100),g(),a.image.dir){case 0:for(var i=[],e=0;e<a.template.data.width;e++)for(var f=0;f<a.template.data.height;f++){var h=j(e,f);null!=h&&i.push(h)}i.length>0&&k(i[Math.floor(Math.random()*i.length)]);break;case 1:for(var e=0;e<a.template.data.width;e++)for(var f=0;f<a.template.data.height;f++){var h=j(e,f);if(null!=h)return void k(h)}break;case 2:for(var e=a.template.data.width-1;e>0;e--)for(var f=0;f<a.template.data.height;f++){var h=j(e,f);if(null!=h)return void k(h)}break;case 3:for(var f=0;f<a.template.data.height;f++)for(var e=0;e<a.template.data.width;e++){var h=j(e,f);if(null!=h)return void k(h)}break;case 4:for(var f=a.template.data.height-1;f>0;f--)for(var e=0;e<a.template.data.width;e++){var h=j(e,f);if(null!=h)return void k(h)}break;case 5:for(var e=0;e<a.template.data.width;e++)for(var f=e%2;f<a.template.data.height;f+=2){var h=j(e,f);if(null!=h)return void k(h)}for(var e=0;e<a.template.data.width;e++)for(var f=1-e%2;f<a.template.data.height;f+=2){var h=j(e,f);if(null!=h)return void k(h)}break;default:console.warn("Unknown direction index")}}function j(b,c){var d=b+a.image.x,e=c+a.image.y,f=getPixel(a.template.data,b,c),g=getPixel(a.board.data,d,e);if(f[3]<=127)return null;for(var h=0;h<a.image.ignore.length;h++)if(pixelEquals(a.image.ignore[h],f))return null;if(a.image.pixelize&&(f=nearesColors(f)),!pixelEquals(f,g)){var i=getColorIndex(f);return-1==i&&console.warn("Incorrect color !"),{x:d,y:e,color:i}}return null}function k(a){console.log("Place.."),App.switchColor(a.color),App.attemptPlace(a.x,a.y),App.alert("Placed at ["+a.x+", "+a.y+"] Color "+a.color)}function l(){function e(){b.find("#filledpercent").text("Filled "+d+"%")}var b,c=!1;return function(){return $("head").append("<style>.botpanel {\tpadding: 10px;\tcolor: white;\tbox-shadow: 0 0 15px rgba(0,0,0,0.9);\tbackground-color: rgba(0,0,0,0.8);\tborder-radius: 3px;\tbottom: 110px;\topacity: 0.8;\tright: 20px;    position: absolute;\ttransition: opacity 0.3s ease-in-out;}.botpanel:hover {\topacity: 1.0;}.botpanel button, .botpanel select {\tbackground-color: #109254;\tborder: none;\tcolor: white;\tpadding: 3px 15px;\ttext-align: center;\ttext-decoration: none;\tdisplay: inline-block;\tfont-size: 14px;\tborder-radius: 3px;\twidth: 100%;\tmargin: 2px;\tcursor: pointer;}.botpanel a {\tcolor: #109254;}</style>"),b=$("#ui"),App.alert("Добро пожаловать! ру дискорд чат => discord.gg/zfJNtw3"),b.append('<div class="botpanel"><a target="_blank" title="[Discord]" href="discord.gg/zfJNtw3">RU PXLS.SPACE</a><br>'+a.image.title+"<br>["+a.image.x+", "+a.image.y+']<br><span id="filledpercent">Filled '+d+'%</span><br><button id="restartbot">Restart Bot</button><br><button id="screenshot">Screenshot</button><br><button id="preview">Preview</button><br><select id="selectdir"><option value="0">Random</option><option value="1">Left - Right</option><option value="2">Right - Left</option><option value="3">Top - Bottom</option><option value="4">Bottom - Top</option><option value="5">Chess</option></select></div>'),b.find("#selectdir").val(""+a.image.dir),b.find("#restartbot").click(function(){i()}),b.find("#screenshot").click(function(){var a=document.getElementById("board"),b=new Image;b.src=a.toDataURL("image/png");var c=document.createElement("a");c.setAttribute("download","board.png"),c.setAttribute("href",b.src),c.appendChild(b),c.click()}),b.find("#preview").click(function(){c=!c,c?($(this).css("background-color","#ff2967"),a.board.context.globalAlpha=.6,a.board.context.drawImage(a.template.canvas,a.image.x,a.image.y),a.board.context.globalAlpha=1):($(this).css("background-color","#109254"),updateBoardData(a.board))}),b.find("#selectdir").change(function(b){a.image.dir=parseInt($(this).val())}),e}()}var b=countPoints(a.template.data),c=!1,d=0;App.banMe=function(){};var e=App.socket.onmessage;App.socket.onmessage=function(a){if("captcha_required"==JSON.parse(a.data).type)if(c=!0,"granted"!==Notification.permission)Notification.requestPermission();else{var d=new Notification("Pxls.space",{body:"Введите капчу!"});d.onclick=function(){window.focus(),this.close()}}e(a)};var f=recaptchaCallback;recaptchaCallback=function(a){console.log("Captcha OK"),c=!1,f(a)};var g=l();setTimeout(h,FORCE_DELAY)}var palette=[[255,255,255],[228,228,228],[136,136,136],[34,34,34],[255,167,209],[229,0,0],[229,149,0],[160,106,66],[229,217,0],[148,224,68],[2,190,1],[0,211,221],[0,131,199],[0,0,234],[207,110,228],[130,0,128]];Notabot.prototype.start=function(){var a={image:new Image,canvas:document.createElement("canvas"),context:null,data:null},b={canvas:document.getElementById("board"),context:null,data:null};a.context=a.canvas.getContext("2d"),b.context=b.canvas.getContext("2d"),this.template=a,this.board=b;var c=this;a.image.onload=function(){if(a.canvas.width=a.image.width,a.canvas.height=a.image.height,a.context.drawImage(a.image,0,0),b.data=updateBoardData(b),a.data=a.context.getImageData(0,0,a.image.width,a.image.height),!c.image.pixelize){var d=validateTemplate(a.data);if(!d.valid)return void App.alert("Incorrect color "+d.pixel+" at ["+d.x+", "+d.y+"]");console.log("Template valid true")}App.alert("Title: "+c.image.title),launchBot(c)},a.image.crossOrigin="anonymous",a.image.src=this.image.src};var FORCE_DELAY=1e3,WAIT_DELAY=1e3,DRAW_DELAY=3e3;